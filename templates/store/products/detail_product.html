{% extends '../base.html' %}
{% load static %}
{% load humanize %}
{% block title %}Product Detail{% endblock %}

{% block content %}

<section style="background-color: #eee;">
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-md-8 col-lg-6 col-xl-4">
        <div class="card text-black">
          <i class="fab fa-apple fa-lg pt-3 pb-1 px-3"></i>
          <img src="{{product.image.url}}" class="card-img-top" alt="Apple Computer" />
          <div class="card-body">
            <div class="text-center">
              <h5 class="card-title">{{product.title}}</h5>
              <p><span class="lead">{{ product.author }}</span> (Author)</p>
              <p class="text-muted mb-4">{{product.description|slice:":355"}}</p>
            </div>
            <div>
              <div class="d-flex justify-content-between">
                <div class="col-6">Hardback</div>
                <div class="col-6 text-end"><span class="h4 fw-bold">Â£{{ product.price }}</span></div>
              </div>
              <div class="d-flex justify-content-between">
                <div class="col-6">
                  <label for="select">Qty</label>
                  <select id="select">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                  </select>

                </div>
                <div class="col-6 text-end">
                  <button type="button" id="add-button" value="{{product.id}}" class="btn btn-secondary btn-sm">
                    Add to basket
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  $(document).on('click', '#add-button', function(e){
    e.preventDefault();
//    console.log($('#select option:selected').text())
    $.ajax({
      type: "POST",
      url: "{% url 'basket:basket_add' %}",
      data: {
        product_id: $('#add-button').val(),
        product_qty:$('#select option:selected').text(),
        csrfmiddlewaretoken: "{{csrf_token}}",
        action: 'post'
      },
      success: function(json){
        console.log(json)
        document.getElementById('qty').innerHTML = json.basket_qty
      },
      error: function(xhr, errmsg, err){

      },
    });
  })
</script>

{% endblock %}